<template>
  <div class="dashboard">

    <!-- IEEE PHM 2012 å¯¦é©—æ‘˜è¦ -->
    <el-row :gutter="20" style="margin-top: 20px;">
      <el-col :span="24">
        <el-card>
          <template #header>
            <div class="card-header">
              <span>ğŸ”¬ IEEE PHM 2012 æ•¸æ“šæŒ‘æˆ°å¯¦é©—æ‘˜è¦</span>
              <el-tag type="info">Remaining Useful Life é æ¸¬</el-tag>
            </div>
          </template>
          
          <el-row :gutter="20">
            <el-col :span="8">
              <el-card shadow="never" class="summary-card">
                <template #header>
                  <div class="summary-header">
                    <el-icon><Aim /></el-icon>
                    <span>å¯¦é©—ç›®çš„</span>
                  </div>
                </template>
                <div class="summary-content">
                  <p><strong>è»¸æ‰¿å‰©é¤˜ä½¿ç”¨å£½å‘½ï¼ˆRULï¼‰é æ¸¬</strong></p>
                  <p>å°ˆæ³¨æ–¼æ—‹è½‰æ©Ÿæ¢°ä¸­è»¸æ‰¿æ•…éšœçš„é æ¸¬ï¼Œæé«˜å·¥æ¥­æ©Ÿæ¢°çš„å¯ç”¨æ€§ã€å®‰å…¨æ€§å’Œæˆæœ¬æ•ˆç›Šã€‚</p>
                  <el-divider />
                  <p><strong>å¤±æ•ˆæ¨™æº–ï¼š</strong>æŒ¯å‹•å¹…åº¦è¶…é 20g</p>
                  <p><strong>å¹³å°ï¼š</strong>PRONOSTIA å¯¦é©—å¹³å°</p>
                  <p><strong>åœ°é»ï¼š</strong>FEMTO-ST ç ”ç©¶æ‰€ï¼ˆæ³•åœ‹ï¼‰</p>
                </div>
              </el-card>
            </el-col>

            <el-col :span="8">
              <el-card shadow="never" class="summary-card">
                <template #header>
                  <div class="summary-header">
                    <el-icon><Tools /></el-icon>
                    <span>æ¸¬è©¦æ–¹å¼</span>
                  </div>
                </template>
                <div class="summary-content">
                  <p><strong>è»¸æ‰¿è¦æ ¼ï¼š</strong></p>
                  <ul>
                    <li>å¤–å¾‘ï¼š32mmï¼Œå…§å¾‘ï¼š20mmï¼Œåšåº¦ï¼š7mm</li>
                    <li>13 å€‹æ»¾ç ï¼Œç›´å¾‘ 3.5mm</li>
                    <li>å‹•æ…‹è² è¼‰ï¼š4000Nï¼Œéœæ…‹è² è¼‰ï¼š2470N</li>
                  </ul>
                  <el-divider />
                  <p><strong>ä¸‰ç¨®æ“ä½œæ¢ä»¶ï¼š</strong></p>
                  <el-tag size="small">1800 rpm, 4000 N</el-tag>
                  <el-tag size="small" style="margin: 2px;">1650 rpm, 4200 N</el-tag>
                  <el-tag size="small">1500 rpm, 5000 N</el-tag>
                </div>
              </el-card>
            </el-col>

            <el-col :span="8">
              <el-card shadow="never" class="summary-card">
                <template #header>
                  <div class="summary-header">
                    <el-icon><Folder /></el-icon>
                    <span>è³‡æ–™é›†</span>
                  </div>
                </template>
                <div class="summary-content">
                  <p><strong>è¨“ç·´è³‡æ–™ï¼š</strong>6 å€‹å®Œæ•´çš„é‹è¡Œè‡³å¤±æ•ˆå¯¦é©—</p>
                  <p><strong>æ¸¬è©¦è³‡æ–™ï¼š</strong>11 å€‹æˆªæ–·çš„ç›£æ¸¬è³‡æ–™</p>
                  <el-divider />
                  <p><strong>æ•¸æ“šæ¡é›†ï¼š</strong></p>
                  <ul>
                    <li>æŒ¯å‹•ï¼š25.6 kHz æ¡æ¨£é »ç‡</li>
                    <li>æº«åº¦ï¼š0.1 Hz æ¡æ¨£é »ç‡</li>
                    <li>å…©å€‹åŠ é€Ÿåº¦è¨ˆï¼ˆæ°´å¹³/å‚ç›´ï¼‰</li>
                    <li>RTD ç™½é‡‘æº«åº¦æ„Ÿæ¸¬å™¨</li>
                  </ul>
                  <p><strong>å¯¦é©—æ™‚é•·ï¼š</strong>1å°æ™‚ - 7å°æ™‚47åˆ†</p>
                </div>
              </el-card>
            </el-col>
          </el-row>

          <el-row style="margin-top: 15px;">
            <el-col :span="24">
              <el-card shadow="never" class="summary-card">
                <template #header>
                  <div class="summary-header">
                    <el-icon><TrendCharts /></el-icon>
                    <span>æŒ‘æˆ°ç‰¹è‰²èˆ‡æŠ€è¡“é‡é»</span>
                  </div>
                </template>
                <div class="summary-content">
                  <el-row :gutter="15">
                    <el-col :span="6">
                      <div class="challenge-item">
                        <el-tag type="warning" size="small">å°è¨“ç·´é›†</el-tag>
                        <p>åƒ…6å€‹é‹è¡Œè‡³å¤±æ•ˆå¯¦é©—</p>
                      </div>
                    </el-col>
                    <el-col :span="6">
                      <div class="challenge-item">
                        <el-tag type="danger" size="small">é«˜è®Šç•°æ€§</el-tag>
                        <p>è»¸æ‰¿å£½å‘½å·®ç•°æ¥µå¤§</p>
                      </div>
                    </el-col>
                    <el-col :span="6">
                      <div class="challenge-item">
                        <el-tag type="info" size="small">å¤šå¤±æ•ˆæ¨¡å¼</el-tag>
                        <p>æ»¾ç ã€å…§/å¤–ç’°ã€ä¿æŒæ¶</p>
                      </div>
                    </el-col>
                    <el-col :span="6">
                      <div class="challenge-item">
                        <el-tag type="success" size="small">çœŸå¯¦åŠ£åŒ–</el-tag>
                        <p>è‡ªç„¶åŠ£åŒ–ç„¡äººå·¥ç¼ºé™·</p>
                      </div>
                    </el-col>
                  </el-row>
                  <el-divider />
                  <div class="scoring-info">
                    <strong>è©•åˆ†æ–¹æ³•ï¼š</strong>éå°ç¨±è©•åˆ†å‡½æ•¸ï¼Œå°æ—©æœŸå’Œæ™šæœŸé æ¸¬æ¡ç”¨ä¸åŒæ‡²ç½°æ©Ÿåˆ¶
                    <br><strong>ç²çè€…ï¼š</strong>å·¥æ¥­çµ„ - A.L.D. Ltd. (ä»¥è‰²åˆ—)ï¼Œå­¸è¡“çµ„ - CALCE, University of Maryland
                  </div>
                </div>
              </el-card>
            </el-col>
          </el-row>

          <!-- CALCE åœ˜éšŠé æ¸¬æ–¹æ³• (åŸºæ–¼ Edwin2012 è«–æ–‡) -->
          <el-row style="margin-top: 15px;">
            <el-col :span="24">
              <el-card shadow="never" class="summary-card">
                <template #header>
                  <div class="summary-header">
                    <el-icon><Document /></el-icon>
                    <span>CALCE åœ˜éšŠ RUL é æ¸¬æ–¹æ³•</span>
                    <el-tag type="success" size="small">å­¸è¡“çµ„å† è»</el-tag>
                  </div>
                </template>
                <div class="summary-content">
                  <p style="margin-bottom: 16px; font-style: italic; color: #606266;">
                    é¦¬é‡Œè˜­å¤§å­¸ CALCE ä¸­å¿ƒæå‡ºä¸‰ç¨®åŸºæ–¼æ•¸æ“šé©…å‹•çš„è»¸æ‰¿å‰©é¤˜ä½¿ç”¨å£½å‘½ï¼ˆRULï¼‰é æ¸¬æ–¹æ³•ï¼Œ
                    å…¶ä¸­æ–¹æ³•ä¸‰ï¼ˆç•°å¸¸æª¢æ¸¬èˆ‡å­˜æ´»æ™‚é–“æ¯”ï¼‰è´å¾—äº† 2012 å¹´ PHM è³‡æ–™æŒ‘æˆ°è³½å­¸è¡“çµ„å† è»ã€‚
                  </p>

                  <el-collapse accordion>
                    <!-- æ–¹æ³•ä¸€ -->
                    <el-collapse-item name="method1">
                      <template #title>
                        <div class="method-title">
                          <el-tag type="primary" size="small">æ–¹æ³•ä¸€</el-tag>
                          <span>ç§»å‹•å¹³å‡å…‰è­œå³­åº¦èˆ‡è²è‘‰æ–¯è’™åœ°å¡ç¾…</span>
                        </div>
                      </template>
                      <div class="method-content">
                        <h4>æ ¸å¿ƒæ€æƒ³</h4>
                        <p>åˆ©ç”¨ç‰¹å®šé »å¸¶ï¼ˆ5.5-6.0 kHzï¼‰çš„å³­åº¦ï¼ˆKurtosisï¼‰ä½œç‚ºç›£æ¸¬è»¸æ‰¿é€€åŒ–çš„æœ€æœ‰æ•ˆå–®èª¿ç‰¹å¾µã€‚</p>

                        <h4>æŠ€è¡“æ­¥é©Ÿ</h4>
                        <ol>
                          <li><strong>ç‰¹å¾µæå–ï¼š</strong>å°æŒ¯å‹•ä¿¡è™Ÿé€²è¡Œå¸¶é€šæ¿¾æ³¢ï¼Œè¨ˆç®—å…‰è­œå³­åº¦ä¸¦é€²è¡Œç§»å‹•å¹³å‡ï¼ˆMAS Kurtosisï¼‰</li>
                          <li><strong>é€€åŒ–å»ºæ¨¡ï¼š</strong>ä½¿ç”¨æŒ‡æ•¸æ¨¡å‹ y = a Ã— exp(bÃ—tÂ²) æ“¬åˆé€€åŒ–è¶¨å‹¢</li>
                          <li><strong>åƒæ•¸æ›´æ–°ï¼š</strong>åˆ©ç”¨è²è‘‰æ–¯è’™åœ°å¡ç¾…æ–¹æ³•ï¼Œéš¨è‘—æ–°è³‡æ–™åŠ å…¥ä¸æ–·æ›´æ–°æ¨¡å‹åƒæ•¸</li>
                          <li><strong>RUL é æ¸¬ï¼š</strong>é æ¸¬å³­åº¦å€¼ä½•æ™‚è¶…éæ•…éšœé–¾å€¼ï¼ˆ4.0ï¼‰</li>
                        </ol>

                        <h4>å„ªå‹¢èˆ‡ç‰¹é»</h4>
                        <ul>
                          <li>âœ… èƒ½æä¾› RUL çš„æ©Ÿç‡åˆ†ä½ˆï¼Œæœ‰åŠ©æ–¼é¢¨éšªç®¡ç†</li>
                          <li>âœ… åŸºæ–¼å¥åº·è»¸æ‰¿å³­åº¦å€¼æ‡‰ç‚º 3.0 çš„ç‰©ç†ç†è«–</li>
                          <li>âš ï¸ éœ€è¦æ˜ç¢ºçš„æ•…éšœé–¾å€¼è¨­å®š</li>
                        </ul>
                      </div>
                    </el-collapse-item>

                    <!-- æ–¹æ³•äºŒ -->
                    <el-collapse-item name="method2">
                      <template #title>
                        <div class="method-title">
                          <el-tag type="warning" size="small">æ–¹æ³•äºŒ</el-tag>
                          <span>å¸¶æœ‰æ”¯æŒå‘é‡è¿´æ­¸çš„è»Ÿè¨ˆç®—æ¨¡å‹</span>
                        </div>
                      </template>
                      <div class="method-content">
                        <h4>æ ¸å¿ƒæ€æƒ³</h4>
                        <p>èåˆå¤šç¨®ç‰¹å¾µä¸¦ä½¿ç”¨æ©Ÿå™¨å­¸ç¿’æ–¹æ³•å»ºç«‹å¾ç‰¹å¾µåˆ° RUL çš„æ˜ å°„é—œä¿‚ã€‚</p>

                        <h4>æŠ€è¡“æ­¥é©Ÿ</h4>
                        <ol>
                          <li><strong>å¤šç‰¹å¾µæå–ï¼š</strong>å¾æ°´å¹³å’Œå‚ç›´æŒ¯å‹•ä¿¡è™Ÿå„æå– 17 å€‹ç‰¹å¾µï¼ˆå…± 34 å€‹ï¼‰
                            <ul>
                              <li>é«˜éšéé›¶é»è¨ˆæ•¸æ³•ï¼š5 å€‹ç‰¹å¾µ</li>
                              <li>å°æ³¢è®Šæ›ï¼š10 å€‹ç‰¹å¾µï¼ˆå‰ 5 å±¤è¿‘ä¼¼ä¿‚æ•¸èƒ½é‡ + å‰ 5 å±¤ç´°ç¯€ä¿‚æ•¸èƒ½é‡ï¼‰</li>
                              <li>å…¶ä»–æ™‚åŸŸç‰¹å¾µï¼šç´¯ç©ä¿¡è™Ÿèƒ½é‡ã€æŒ¯å‹•ä¿¡è™Ÿå³°å€¼</li>
                            </ul>
                          </li>
                          <li><strong>ç‰¹å¾µé™ç¶­ï¼š</strong>ä½¿ç”¨ä¸»æˆåˆ†åˆ†æï¼ˆPCAï¼‰å°‡ 34 å€‹ç‰¹å¾µé™è‡³ 3 å€‹ä¸»æˆåˆ†ï¼Œä¿ç•™è¶…é 99.5% çš„è³‡æ–™è®Šç•°æ€§</li>
                          <li><strong>æ©Ÿå™¨å­¸ç¿’ï¼š</strong>è¨“ç·´æœ€å°äºŒä¹˜æ”¯æŒå‘é‡è¿´æ­¸ï¼ˆLS-SVRï¼‰æ¨¡å‹ï¼Œå­¸ç¿’å¾ä¸»æˆåˆ†åˆ° RUL çš„æ˜ å°„</li>
                        </ol>

                        <h4>å„ªå‹¢èˆ‡ç‰¹é»</h4>
                        <ul>
                          <li>âœ… èåˆå¤šç¨®ç‰¹å¾µï¼Œä¿¡æ¯æ›´å…¨é¢</li>
                          <li>âœ… è‡ªå‹•å­¸ç¿’ç‰¹å¾µèˆ‡ RUL çš„è¤‡é›œé—œä¿‚</li>
                          <li>âš ï¸ æ¨¡å¼è­˜åˆ¥èƒ½åŠ›å—é™æ–¼è¨“ç·´è³‡æ–™çš„å¤šæ¨£æ€§</li>
                          <li>âš ï¸ éœ€è¦è¼ƒå¤šçš„æ¨™è¨»è¨“ç·´æ•¸æ“š</li>
                        </ul>
                      </div>
                    </el-collapse-item>

                    <!-- æ–¹æ³•ä¸‰ -->
                    <el-collapse-item name="method3">
                      <template #title>
                        <div class="method-title">
                          <el-tag type="success" size="small">æ–¹æ³•ä¸‰ â­</el-tag>
                          <span>æŒ¯å‹•é »è­œç‰¹å¾µç•°å¸¸æª¢æ¸¬èˆ‡å­˜æ´»æ™‚é–“æ¯”</span>
                          <el-tag type="success" size="small" style="margin-left: 8px;">å† è»æ–¹æ³•</el-tag>
                        </div>
                      </template>
                      <div class="method-content">
                        <h4>æ ¸å¿ƒæ€æƒ³</h4>
                        <p>åŸºæ–¼å¿«é€Ÿå‚…ç«‹è‘‰è®Šæ›ï¼ˆFFTï¼‰æª¢æ¸¬é »è­œç•°å¸¸ï¼Œå°‡è»¸æ‰¿é€€åŒ–éç¨‹åˆ†ç‚ºå¤šå€‹å¯è­˜åˆ¥çš„éšæ®µï¼Œ
                          é‡å°æœ‰ç„¡æ˜é¡¯é€€åŒ–è¶¨å‹¢æ¡ç”¨ä¸åŒçš„é æ¸¬ç­–ç•¥ã€‚</p>

                        <h4>æŠ€è¡“æ­¥é©Ÿ</h4>
                        <ol>
                          <li><strong>ç•°å¸¸æª¢æ¸¬ï¼š</strong>ä½¿ç”¨ FFT è§€å¯Ÿé »è­œä¸­å³°å€¼é »ç‡çš„è®ŠåŒ–ï¼Œæ¨™è¨˜é€€åŒ–éšæ®µçš„é–‹å§‹</li>
                          <li><strong>é å¾Œç‰¹å¾µï¼š</strong>æå–æ¯æ¬¡è§€æ¸¬ä¸­çµ•å°åŠ é€Ÿåº¦å€¼æœ€é«˜çš„ 5 å€‹é»çš„å¹³å‡å€¼</li>
                          <li><strong>åˆ†é¡é æ¸¬ç­–ç•¥ï¼š</strong>
                            <ul>
                              <li><strong>æœ‰æ˜é¡¯é€€åŒ–è¶¨å‹¢çš„è»¸æ‰¿ï¼š</strong>ä½¿ç”¨æŒ‡æ•¸æ›²ç·šæ“¬åˆä¾†å¤–æ’é æ¸¬æ•…éšœæ™‚é–“</li>
                              <li><strong>ç„¡æ˜é¡¯è¶¨å‹¢çš„è»¸æ‰¿ï¼š</strong>è¨ˆç®—è¨“ç·´è³‡æ–™ä¸­å„ç•°å¸¸éšæ®µçš„æŒçºŒæ™‚é–“æ¯”ä¾‹ï¼Œ
                                æ ¹æ“šæ¸¬è©¦è³‡æ–™ç¬¬ä¸€å€‹ç•°å¸¸éšæ®µçš„æŒçºŒæ™‚é–“æ¨ç®—å‰©é¤˜å£½å‘½</li>
                            </ul>
                          </li>
                        </ol>

                        <h4>å„ªå‹¢èˆ‡ç‰¹é»</h4>
                        <ul>
                          <li>ğŸ† åœ¨ 11 å€‹æ¸¬è©¦æ¡ˆä¾‹ä¸­æœ‰ 4 å€‹çš„èª¤å·®åœ¨ 10% ä»¥å…§</li>
                          <li>âœ… èƒ½åŒæ™‚è™•ç†æœ‰ç„¡æ˜é¡¯é€€åŒ–è¶¨å‹¢çš„å…©ç¨®æƒ…æ³</li>
                          <li>âœ… åŸºæ–¼ç‰©ç†æ„ç¾©ï¼ˆé »è­œç•°å¸¸ï¼‰çš„åŠç¶“é©—æ¨¡å‹ï¼Œé­¯æ£’æ€§é«˜</li>
                          <li>âœ… åœ¨è¨“ç·´è³‡æ–™æœ‰é™ã€æ•…éšœæ¨¡å¼æœªçŸ¥çš„æ¢ä»¶ä¸‹ä¾ç„¶æœ‰æ•ˆ</li>
                          <li>âœ… é©åˆè™•ç†è»¸æ‰¿å£½å‘½å·®ç•°æ¥µå¤§çš„æŒ‘æˆ°</li>
                        </ul>

                        <el-divider />

                        <div class="winner-info">
                          <el-icon><Trophy /></el-icon>
                          <span>æ­¤æ–¹æ³•å¹«åŠ© CALCE åœ˜éšŠè´å¾— 2012 å¹´ PHM è³‡æ–™æŒ‘æˆ°è³½å­¸è¡“çµ„å† è»</span>
                        </div>
                      </div>
                    </el-collapse-item>
                  </el-collapse>

                  <el-divider />

                  <!-- ç‰¹å¾µæå–æ–¹æ³•ç¸½çµ -->
                  <div class="feature-summary">
                    <h4>ğŸ“Š æŒ¯å‹•ä¿¡è™Ÿç‰¹å¾µæå–æ–¹æ³•ç¸½çµ</h4>
                    <el-row :gutter="15" style="margin-top: 12px;">
                      <el-col :span="8">
                        <div class="feature-card">
                          <h5>æ™‚åŸŸç‰¹å¾µ</h5>
                          <ul>
                            <li>å‡æ–¹æ ¹ (RMS)</li>
                            <li>å³°å€¼ (Peak)</li>
                            <li>æ³¢å³°å› æ•¸ (Crest Factor)</li>
                            <li>å³­åº¦ (Kurtosis) â­</li>
                            <li>ç´¯ç©ä¿¡è™Ÿèƒ½é‡</li>
                          </ul>
                        </div>
                      </el-col>
                      <el-col :span="8">
                        <div class="feature-card">
                          <h5>é »åŸŸç‰¹å¾µ</h5>
                          <ul>
                            <li>å¿«é€Ÿå‚…ç«‹è‘‰è®Šæ› (FFT)</li>
                            <li>å…‰è­œå³­åº¦ (Spectral Kurtosis)</li>
                            <li>è»¸æ‰¿ç¼ºé™·é »ç‡å¹…åº¦</li>
                            <li>å³°å€¼é »ç‡è®ŠåŒ–æª¢æ¸¬</li>
                          </ul>
                        </div>
                      </el-col>
                      <el-col :span="8">
                        <div class="feature-card">
                          <h5>é€²éšæ–¹æ³•</h5>
                          <ul>
                            <li>å°æ³¢è®Šæ› (Wavelet Transform)</li>
                            <li>é«˜éšéé›¶é»è¨ˆæ•¸</li>
                            <li>ä¸»æˆåˆ†åˆ†æ (PCA)</li>
                            <li>ç§»å‹•å¹³å‡å¹³æ»‘åŒ–</li>
                          </ul>
                        </div>
                      </el-col>
                    </el-row>
                  </div>

                  <el-divider />

                  <!-- ç ”ç©¶è²¢ç» -->
                  <div class="contribution-section">
                    <h4>ğŸ¯ ä¸»è¦ç ”ç©¶è²¢ç»</h4>
                    <ol>
                      <li><strong>é–‹ç™¼æ–°ç©ä¸”æœ‰æ•ˆçš„é æ¸¬æ–¹æ³•ï¼š</strong>ç‰¹åˆ¥æ˜¯æ–¹æ³•ä¸‰ï¼Œåœ¨è¨“ç·´è³‡æ–™æœ‰é™ã€æ•…éšœæ¨¡å¼æœªçŸ¥ä¸”æ•…éšœæ™‚é–“å·®ç•°å·¨å¤§çš„æŒ‘æˆ°æ€§æ¢ä»¶ä¸‹ï¼Œ
                        ä¾ç„¶å–å¾—å„ªç•°çš„é æ¸¬ç²¾åº¦</li>
                      <li><strong>æ¯”è¼ƒä¸åŒé æ¸¬ç­–ç•¥ï¼š</strong>æ–¹æ³•ä¸€èƒ½æä¾› RUL çš„æ©Ÿç‡åˆ†ä½ˆæœ‰åŠ©æ–¼é¢¨éšªç®¡ç†ï¼›
                        æ–¹æ³•äºŒçš„æ¨¡å¼è­˜åˆ¥èƒ½åŠ›å—é™æ–¼è¨“ç·´è³‡æ–™å¤šæ¨£æ€§ï¼›æ–¹æ³•ä¸‰çš„åŠç¶“é©—æ¨¡å‹æœ€å…·é­¯æ£’æ€§</li>
                      <li><strong>å¯¦è¸æ€§è¦‹è§£ï¼š</strong>åœ¨è³‡æ–™æœ‰é™çš„æƒ…æ³ä¸‹ï¼ŒåŸºæ–¼ç‰©ç†æ„ç¾©çš„åŠç¶“é©—æ¨¡å‹å¯èƒ½æ¯”ç´”ç²¹çš„æ©Ÿå™¨å­¸ç¿’æ¨¡å‹æ›´å…·é­¯æ£’æ€§</li>
                    </ol>
                  </div>

                  <el-alert
                    title="ğŸ“š åƒè€ƒæ–‡ç»"
                    type="info"
                    :closable="false"
                    style="margin-top: 16px;"
                  >
                    <p style="font-size: 12px; margin: 0;">
                      Edwin Sutrisno et al., "Estimation of Remaining Useful Life of Ball Bearings using Data Driven Methodologies",
                      IEEE PHM 2012 Data Challenge, CALCE Center, University of Maryland
                    </p>
                  </el-alert>
                </div>
              </el-card>
            </el-col>
          </el-row>
        </el-card>
      </el-col>
    </el-row>

    <!-- PHM è¨“ç·´æ•¸æ“šè¦–è¦ºåŒ– -->
    <el-row :gutter="20" style="margin-top: 20px;">
      <el-col :span="24">
        <el-card>
          <template #header>
            <div class="card-header">
              <span>ğŸ“Š PHM 2012 è¨“ç·´æ•¸æ“šè¦–è¦ºåŒ–</span>
              <el-tag type="info">å…± {{ trainingData?.total_bearings || 0 }} å€‹è»¸æ‰¿</el-tag>
            </div>
          </template>

          <!-- è¼‰å…¥ç‹€æ…‹ -->
          <div v-if="trainingLoading" class="loading-container">
            <el-icon class="is-loading"><Loading /></el-icon>
            <p>è¼‰å…¥è¨“ç·´æ•¸æ“šä¸­...</p>
          </div>

          <!-- æ•¸æ“šæ‘˜è¦è¡¨æ ¼ -->
          <div v-if="!trainingLoading && trainingData">
            <el-table :data="trainingData.bearings" stripe style="width: 100%">
              <el-table-column prop="name" label="è»¸æ‰¿ç·¨è™Ÿ" width="120" />
              <el-table-column label="æ“ä½œæ¢ä»¶" width="120">
                <template #default="scope">
                  <el-tag :type="getConditionType(scope.row.condition)">
                    Condition {{ scope.row.condition }}
                  </el-tag>
                </template>
              </el-table-column>
              <el-table-column prop="load_N" label="è² è¼‰ (N)" width="100" />
              <el-table-column prop="speed_rpm" label="è½‰é€Ÿ (RPM)" width="120" />
              <el-table-column prop="actual_RUL_min" label="å¯¦éš› RUL (åˆ†é˜)" width="150">
                <template #default="scope">
                  <strong>{{ scope.row.actual_RUL_min }}</strong>
                </template>
              </el-table-column>
              <el-table-column prop="num_files" label="æ•¸æ“šæ–‡ä»¶æ•¸" width="120" />
              <el-table-column prop="total_duration_min" label="ç¸½æ™‚é•· (åˆ†é˜)" width="130" />
              <el-table-column label="æ“ä½œ" width="150">
                <template #default="scope">
                  <el-button
                    type="primary"
                    size="small"
                    @click="viewBearingDetails(scope.row)"
                  >
                    æŸ¥çœ‹è©³æƒ…
                  </el-button>
                </template>
              </el-table-column>
            </el-table>
          </div>

          <!-- çµ±è¨ˆåœ–è¡¨ -->
          <div v-if="!trainingLoading && statisticsData.length > 0" style="margin-top: 30px;">
            <el-card class="chart-card">
              <template #header>
                <div class="card-header">
                  <span>æŒ¯å‹•è¶¨å‹¢åˆ†æ</span>
                  <el-select
                    v-model="selectedTrainingBearing"
                    placeholder="é¸æ“‡è»¸æ‰¿"
                    style="width: 200px"
                  >
                    <el-option
                      v-for="bearing in trainingBearingOptions"
                      :key="bearing"
                      :label="bearing"
                      :value="bearing"
                    />
                  </el-select>
                </div>
              </template>

              <canvas ref="chartContainer" style="width: 100%; height: 400px"></canvas>
            </el-card>

            <!-- å³°åº¦è¶¨å‹¢åœ– -->
            <el-card class="chart-card" style="margin-top: 20px;">
              <template #header>
                <span>å³°åº¦è¶¨å‹¢åˆ†æï¼ˆæ•…éšœæŒ‡æ¨™ï¼‰</span>
              </template>

              <canvas ref="kurtosisChartContainer" style="width: 100%; height: 400px"></canvas>
            </el-card>

            <!-- æ•¸æ“šåˆ†æèªªæ˜ -->
            <el-card class="info-card-phm" style="margin-top: 20px;">
              <template #header>
                <span>ğŸ“– æ•¸æ“šèªªæ˜</span>
              </template>

              <el-descriptions :column="2" border>
                <el-descriptions-item label="æ•¸æ“šé›†">PHM IEEE 2012 Challenge - Learning Set</el-descriptions-item>
                <el-descriptions-item label="æ¡æ¨£ç‡">25,600 Hz</el-descriptions-item>
                <el-descriptions-item label="æ“ä½œæ¢ä»¶">3 ç¨®ä¸åŒè² è¼‰-è½‰é€Ÿçµ„åˆ</el-descriptions-item>
                <el-descriptions-item label="æ•¸æ“šé¡å‹">æ°´å¹³ + å‚ç›´æŒ¯å‹•</el-descriptions-item>
                <el-descriptions-item label="å³°åº¦æ­£å¸¸å€¼">â‰ˆ 3</el-descriptions-item>
                <el-descriptions-item label="å³°åº¦ç•°å¸¸å€¼">> 5-10 è¡¨ç¤ºæ•…éšœ</el-descriptions-item>
              </el-descriptions>

              <el-divider />

              <h4>é—œéµç™¼ç¾ï¼š</h4>
              <ul>
                <li>âœ… <strong>å³°åº¦æ˜¯æœ€å¯é çš„æ—©æœŸæ•…éšœæŒ‡æ¨™</strong>ï¼Œåœ¨å¤šæ•¸æ¡ˆä¾‹ä¸­æä¾› 1000-3000 åˆ†é˜é è­¦</li>
                <li>âœ… <strong>å‚ç›´æŒ¯å‹•é€šå¸¸æ¯”æ°´å¹³æŒ¯å‹•æ›´æ—©é¡¯ç¤ºé€€åŒ–è·¡è±¡</strong></li>
                <li>âš ï¸ Bearing3_1 (é«˜è² è¼‰ 5000N) å…·æœ‰æœ€çŸ­å£½å‘½ (5730 åˆ†é˜) å’Œæœ€çªç™¼çš„æ•…éšœæ¨¡å¼</li>
                <li>â­ Bearing1_1 æ“æœ‰æœ€è±å¯Œæ•¸æ“š (2803 files) å’Œæœ€é•·å£½å‘½ (28020 åˆ†é˜)</li>
              </ul>
            </el-card>
          </div>
        </el-card>
      </el-col>
    </el-row>

    <!-- PHM è³‡æ–™åº«æŸ¥è©¢ -->
    <el-row :gutter="20" style="margin-top: 20px;">
      <el-col :span="24">
        <el-card>
          <template #header>
            <div class="card-header">
              <span>ğŸ’¾ PHM è³‡æ–™åº«æŸ¥è©¢</span>
              <el-tag type="success">æŸ¥è©¢ PHM IEEE 2012 è¨“ç·´è³‡æ–™é›†</el-tag>
            </div>
          </template>

          <!-- Bearings List -->
          <div class="bearings-section">
            <h3 class="section-title">è»¸æ‰¿åˆ—è¡¨</h3>
            <div v-if="loading" class="loading">è¼‰å…¥ä¸­...</div>
            <div v-else-if="error" class="error">{{ error }}</div>
            <div v-else class="bearings-grid">
              <div
                v-for="bearing in bearings"
                :key="bearing.bearing_id"
                class="bearing-card"
                :class="{ active: selectedBearing === bearing.bearing_name }"
                @click="selectBearing(bearing.bearing_name)"
              >
                <h4>{{ bearing.bearing_name }}</h4>
                <div class="bearing-stats">
                  <div class="stat-item">
                    <span class="stat-label">æª”æ¡ˆæ•¸:</span>
                    <span class="stat-value">{{ bearing.file_count?.toLocaleString() }}</span>
                  </div>
                  <div class="stat-item">
                    <span class="stat-label">æ¸¬é‡è¨˜éŒ„:</span>
                    <span class="stat-value">{{ bearing.measurement_count?.toLocaleString() }}</span>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- Bearing Details -->
          <div v-if="selectedBearing" style="margin-top: 30px;">
            <h3 class="section-title">{{ selectedBearing }} è©³ç´°è³‡è¨Š</h3>

            <!-- Tabs -->
            <el-tabs v-model="activeTab" @tab-change="handleTabChange">
              <el-tab-pane label="åŸºæœ¬è³‡è¨Š" name="info">
                <div v-if="bearingInfo" class="info-grid">
                  <el-card shadow="never" class="info-card">
                    <template #header>
                      <div class="info-header">
                        <el-icon><DataBoard /></el-icon>
                        <span>çµ±è¨ˆæ‘˜è¦</span>
                      </div>
                    </template>
                    <div class="info-content">
                      <div class="info-item">
                        <span class="label">è»¸æ‰¿ ID:</span>
                        <span class="value">{{ bearingInfo.bearing_id }}</span>
                      </div>
                      <div class="info-item">
                        <span class="label">æª”æ¡ˆæ•¸é‡:</span>
                        <span class="value">{{ bearingInfo.file_count?.toLocaleString() }}</span>
                      </div>
                      <div class="info-item">
                        <span class="label">æ¸¬é‡è¨˜éŒ„:</span>
                        <span class="value">{{ bearingInfo.measurement_count?.toLocaleString() }}</span>
                      </div>
                    </div>
                  </el-card>

                  <el-card shadow="never" class="info-card">
                    <template #header>
                      <div class="info-header">
                        <el-icon><DataLine /></el-icon>
                        <span>æ°´å¹³åŠ é€Ÿåº¦çµ±è¨ˆ</span>
                      </div>
                    </template>
                    <div class="info-content">
                      <div class="info-item">
                        <span class="label">å¹³å‡å€¼:</span>
                        <span class="value">{{ bearingInfo.acceleration_stats?.avg_h_acc?.toFixed(3) }}</span>
                      </div>
                      <div class="info-item">
                        <span class="label">æœ€å°å€¼:</span>
                        <span class="value">{{ bearingInfo.acceleration_stats?.min_h_acc?.toFixed(3) }}</span>
                      </div>
                      <div class="info-item">
                        <span class="label">æœ€å¤§å€¼:</span>
                        <span class="value">{{ bearingInfo.acceleration_stats?.max_h_acc?.toFixed(3) }}</span>
                      </div>
                      <div class="info-item">
                        <span class="label">å¹³å‡çµ•å°å€¼:</span>
                        <span class="value">{{ bearingInfo.acceleration_stats?.avg_abs_h_acc?.toFixed(3) }}</span>
                      </div>
                    </div>
                  </el-card>

                  <el-card shadow="never" class="info-card">
                    <template #header>
                      <div class="info-header">
                        <el-icon><DataLine /></el-icon>
                        <span>å‚ç›´åŠ é€Ÿåº¦çµ±è¨ˆ</span>
                      </div>
                    </template>
                    <div class="info-content">
                      <div class="info-item">
                        <span class="label">å¹³å‡å€¼:</span>
                        <span class="value">{{ bearingInfo.acceleration_stats?.avg_v_acc?.toFixed(3) }}</span>
                      </div>
                      <div class="info-item">
                        <span class="label">æœ€å°å€¼:</span>
                        <span class="value">{{ bearingInfo.acceleration_stats?.min_v_acc?.toFixed(3) }}</span>
                      </div>
                      <div class="info-item">
                        <span class="label">æœ€å¤§å€¼:</span>
                        <span class="value">{{ bearingInfo.acceleration_stats?.max_v_acc?.toFixed(3) }}</span>
                      </div>
                      <div class="info-item">
                        <span class="label">å¹³å‡çµ•å°å€¼:</span>
                        <span class="value">{{ bearingInfo.acceleration_stats?.avg_abs_v_acc?.toFixed(3) }}</span>
                      </div>
                    </div>
                  </el-card>
                </div>
              </el-tab-pane>

              <el-tab-pane label="æª”æ¡ˆåˆ—è¡¨" name="files">
                <div class="controls">
                  <el-button @click="loadFiles(0)" :loading="filesLoading" size="small">
                    é‡æ–°è¼‰å…¥
                  </el-button>
                  <span class="page-info">
                    é¡¯ç¤º {{ filesOffset + 1 }} - {{ Math.min(filesOffset + filesLimit, filesTotalCount) }}
                    / å…± {{ filesTotalCount }} ç­†
                  </span>
                </div>

                <div v-if="filesLoading" class="loading">è¼‰å…¥ä¸­...</div>
                <div v-else-if="files.length === 0" class="empty">ç„¡æª”æ¡ˆè³‡æ–™</div>
                <el-table v-else :data="files" stripe style="width: 100%">
                  <el-table-column prop="file_number" label="æª”æ¡ˆç·¨è™Ÿ" width="100" />
                  <el-table-column prop="file_name" label="æª”æ¡ˆåç¨±" width="180" />
                  <el-table-column prop="record_count" label="è¨˜éŒ„æ•¸" width="120">
                    <template #default="scope">
                      {{ scope.row.record_count?.toLocaleString() }}
                    </template>
                  </el-table-column>
                  <el-table-column prop="avg_h_acc" label="å¹³å‡æ°´å¹³åŠ é€Ÿåº¦" width="140">
                    <template #default="scope">
                      {{ scope.row.avg_h_acc?.toFixed(3) }}
                    </template>
                  </el-table-column>
                  <el-table-column prop="avg_v_acc" label="å¹³å‡å‚ç›´åŠ é€Ÿåº¦" width="140">
                    <template #default="scope">
                      {{ scope.row.avg_v_acc?.toFixed(3) }}
                    </template>
                  </el-table-column>
                  <el-table-column prop="max_abs_h_acc" label="æœ€å¤§çµ•å°å€¼(H)" width="130">
                    <template #default="scope">
                      {{ scope.row.max_abs_h_acc?.toFixed(3) }}
                    </template>
                  </el-table-column>
                  <el-table-column prop="max_abs_v_acc" label="æœ€å¤§çµ•å°å€¼(V)" width="130">
                    <template #default="scope">
                      {{ scope.row.max_abs_v_acc?.toFixed(3) }}
                    </template>
                  </el-table-column>
                  <el-table-column label="æ“ä½œ" width="100">
                    <template #default="scope">
                      <el-button size="small" @click="loadFileData(scope.row.file_number)">
                        æŸ¥çœ‹è³‡æ–™
                      </el-button>
                    </template>
                  </el-table-column>
                </el-table>

                <el-pagination
                  v-if="filesTotalCount > 0"
                  :current-page="Math.floor(filesOffset / filesLimit) + 1"
                  :page-size="filesLimit"
                  :total="filesTotalCount"
                  layout="prev, pager, next"
                  @current-change="handleFilesPageChange"
                  style="margin-top: 20px; justify-content: center;"
                />
              </el-tab-pane>

              <el-tab-pane label="æ¸¬é‡è³‡æ–™" name="measurements">
                <div class="controls">
                  <el-input
                    v-model.number="fileNumberFilter"
                    placeholder="è¼¸å…¥æª”æ¡ˆç·¨è™Ÿ (é¸å¡«)"
                    style="width: 200px;"
                    size="small"
                  />
                  <el-button @click="loadMeasurements(0)" :loading="measurementsLoading" size="small">
                    æŸ¥è©¢
                  </el-button>
                  <span class="page-info">
                    é¡¯ç¤º {{ measurementsOffset + 1 }} -
                    {{ Math.min(measurementsOffset + measurementsLimit, measurementsTotalCount) }}
                    / å…± {{ measurementsTotalCount?.toLocaleString() }} ç­†
                  </span>
                </div>

                <div v-if="measurementsLoading" class="loading">è¼‰å…¥ä¸­...</div>
                <div v-else-if="measurements.length === 0" class="empty">ç„¡æ¸¬é‡è³‡æ–™</div>
                <el-table v-else :data="measurements" stripe style="width: 100%">
                  <el-table-column prop="file_number" label="æª”æ¡ˆç·¨è™Ÿ" width="100" />
                  <el-table-column label="æ™‚:åˆ†:ç§’.å¾®ç§’" width="180">
                    <template #default="scope">
                      {{ scope.row.hour }}:{{ scope.row.minute }}:{{ scope.row.second }}.{{ scope.row.microsecond }}
                    </template>
                  </el-table-column>
                  <el-table-column prop="horizontal_acceleration" label="æ°´å¹³åŠ é€Ÿåº¦" width="150">
                    <template #default="scope">
                      {{ scope.row.horizontal_acceleration?.toFixed(3) }}
                    </template>
                  </el-table-column>
                  <el-table-column prop="vertical_acceleration" label="å‚ç›´åŠ é€Ÿåº¦" width="150">
                    <template #default="scope">
                      {{ scope.row.vertical_acceleration?.toFixed(3) }}
                    </template>
                  </el-table-column>
                </el-table>

                <el-pagination
                  v-if="measurementsTotalCount > 0"
                  :current-page="Math.floor(measurementsOffset / measurementsLimit) + 1"
                  :page-size="measurementsLimit"
                  :total="measurementsTotalCount"
                  layout="prev, pager, next"
                  @current-change="handleMeasurementsPageChange"
                  style="margin-top: 20px; justify-content: center;"
                />
              </el-tab-pane>

              <el-tab-pane label="ç•°å¸¸æª¢æ¸¬" name="anomalies">
                <div class="controls">
                  <el-input-number
                    v-model="thresholdH"
                    :precision="1"
                    :step="0.5"
                    :min="0"
                    size="small"
                    style="width: 150px;"
                  >
                    <template #prefix>æ°´å¹³é–¾å€¼:</template>
                  </el-input-number>
                  <el-input-number
                    v-model="thresholdV"
                    :precision="1"
                    :step="0.5"
                    :min="0"
                    size="small"
                    style="width: 150px;"
                  >
                    <template #prefix>å‚ç›´é–¾å€¼:</template>
                  </el-input-number>
                  <el-button @click="searchAnomalies" :loading="anomaliesLoading" type="primary" size="small">
                    æœå°‹ç•°å¸¸
                  </el-button>
                </div>

                <div v-if="anomaliesLoading" class="loading">è¼‰å…¥ä¸­...</div>
                <div v-else-if="anomalies.length === 0" class="empty">
                  ç„¡ç•°å¸¸è³‡æ–™ (é–¾å€¼: H={{ thresholdH }}, V={{ thresholdV }})
                </div>
                <div v-else>
                  <el-alert
                    :title="`æ‰¾åˆ° ${anomalies.length} ç­†ç•°å¸¸è³‡æ–™`"
                    type="warning"
                    :closable="false"
                    style="margin-bottom: 15px;"
                  />
                  <el-table :data="anomalies" stripe style="width: 100%">
                    <el-table-column prop="file_number" label="æª”æ¡ˆç·¨è™Ÿ" width="100" />
                    <el-table-column prop="file_name" label="æª”æ¡ˆåç¨±" width="150" />
                    <el-table-column label="æ™‚é–“" width="180">
                      <template #default="scope">
                        {{ scope.row.hour }}:{{ scope.row.minute }}:{{ scope.row.second }}.{{ scope.row.microsecond }}
                      </template>
                    </el-table-column>
                    <el-table-column label="æ°´å¹³åŠ é€Ÿåº¦" width="150">
                      <template #default="scope">
                        <span :class="{ 'anomaly-value': Math.abs(scope.row.horizontal_acceleration) > thresholdH }">
                          {{ scope.row.horizontal_acceleration?.toFixed(3) }}
                        </span>
                      </template>
                    </el-table-column>
                    <el-table-column label="å‚ç›´åŠ é€Ÿåº¦" width="150">
                      <template #default="scope">
                        <span :class="{ 'anomaly-value': Math.abs(scope.row.vertical_acceleration) > thresholdV }">
                          {{ scope.row.vertical_acceleration?.toFixed(3) }}
                        </span>
                      </template>
                    </el-table-column>
                  </el-table>
                </div>
              </el-tab-pane>
            </el-tabs>
          </div>
        </el-card>
      </el-col>
    </el-row>

  </div>
</template>

<script setup>
import { ref, onMounted, watch, nextTick } from 'vue'
import axios from 'axios'
import { Aim, Tools, Folder, TrendCharts, DataBoard, DataLine, Loading, Document, Trophy } from '@element-plus/icons-vue'
import { ElMessage } from 'element-plus'
import api from '@/stores/api'
import { Chart } from 'chart.js/auto'

const API_BASE = 'http://localhost:8081'

// State
const loading = ref(false)
const error = ref(null)
const bearings = ref([])
const selectedBearing = ref(null)
const bearingInfo = ref(null)
const activeTab = ref('info')

// Files
const files = ref([])
const filesLoading = ref(false)
const filesOffset = ref(0)
const filesLimit = ref(20)
const filesTotalCount = ref(0)

// Measurements
const measurements = ref([])
const measurementsLoading = ref(false)
const measurementsOffset = ref(0)
const measurementsLimit = ref(100)
const measurementsTotalCount = ref(0)
const fileNumberFilter = ref(null)

// Anomalies
const anomalies = ref([])
const anomaliesLoading = ref(false)
const thresholdH = ref(10.0)
const thresholdV = ref(10.0)

// PHM Training Data
const trainingLoading = ref(true)
const trainingData = ref(null)
const statisticsData = ref([])
const selectedTrainingBearing = ref('Bearing1_1')
const trainingBearingOptions = ref([])
const chartContainer = ref(null)
const kurtosisChartContainer = ref(null)
let vibrationChart = null
let kurtosisChart = null

// Load bearings list
const loadBearings = async () => {
  loading.value = true
  error.value = null
  try {
    const response = await axios.get(`${API_BASE}/api/phm/database/bearings`)
    bearings.value = response.data.bearings
  } catch (err) {
    error.value = err.response?.data?.detail || err.message
  } finally {
    loading.value = false
  }
}

// Select bearing
const selectBearing = async (bearingName) => {
  selectedBearing.value = bearingName
  activeTab.value = 'info'
  await loadBearingInfo(bearingName)
}

// Load bearing info
const loadBearingInfo = async (bearingName) => {
  try {
    const response = await axios.get(
      `${API_BASE}/api/phm/database/bearing/${bearingName}`
    )
    bearingInfo.value = response.data
  } catch (err) {
    console.error('Error loading bearing info:', err)
  }
}

// Load files
const loadFiles = async (offset) => {
  if (!selectedBearing.value) return

  filesLoading.value = true
  filesOffset.value = offset
  try {
    const response = await axios.get(
      `${API_BASE}/api/phm/database/bearing/${selectedBearing.value}/files`,
      { params: { offset, limit: filesLimit.value } }
    )
    files.value = response.data.files
    filesTotalCount.value = response.data.total_count
  } catch (err) {
    console.error('Error loading files:', err)
  } finally {
    filesLoading.value = false
  }
}

// Load measurements
const loadMeasurements = async (offset) => {
  if (!selectedBearing.value) return

  measurementsLoading.value = true
  measurementsOffset.value = offset
  try {
    const params = { offset, limit: measurementsLimit.value }
    if (fileNumberFilter.value) {
      params.file_number = fileNumberFilter.value
    }

    const response = await axios.get(
      `${API_BASE}/api/phm/database/bearing/${selectedBearing.value}/measurements`,
      { params }
    )
    measurements.value = response.data.measurements
    measurementsTotalCount.value = response.data.total_count
  } catch (err) {
    console.error('Error loading measurements:', err)
  } finally {
    measurementsLoading.value = false
  }
}

// Load file data
const loadFileData = async (fileNumber) => {
  activeTab.value = 'measurements'
  fileNumberFilter.value = fileNumber
  await loadMeasurements(0)
}

// Search anomalies
const searchAnomalies = async () => {
  if (!selectedBearing.value) return

  anomaliesLoading.value = true
  try {
    const response = await axios.get(
      `${API_BASE}/api/phm/database/bearing/${selectedBearing.value}/anomalies`,
      {
        params: {
          threshold_h: thresholdH.value,
          threshold_v: thresholdV.value,
          limit: 100
        }
      }
    )
    anomalies.value = response.data.anomalies
  } catch (err) {
    console.error('Error searching anomalies:', err)
  } finally {
    anomaliesLoading.value = false
  }
}

// Tab change handler
const handleTabChange = (tabName) => {
  if (tabName === 'files' && files.value.length === 0) {
    loadFiles(0)
  } else if (tabName === 'measurements' && measurements.value.length === 0) {
    loadMeasurements(0)
  }
}

// Pagination handlers
const handleFilesPageChange = (page) => {
  loadFiles((page - 1) * filesLimit.value)
}

const handleMeasurementsPageChange = (page) => {
  loadMeasurements((page - 1) * measurementsLimit.value)
}

// PHM Training Functions
const getConditionType = (condition) => {
  const types = { 1: 'primary', 2: 'warning', 3: 'success' }
  return types[condition] || 'info'
}

const loadTrainingData = async () => {
  try {
    trainingLoading.value = true

    // è¼‰å…¥æ‘˜è¦æ•¸æ“š
    const summaryData = await api.getPHMTrainingSummary()
    trainingData.value = summaryData
    console.log('Training summary loaded:', summaryData)

    // è¼‰å…¥çµ±è¨ˆæ•¸æ“š
    const analysisData = await api.getPHMAnalysisData()
    const stats = analysisData.statistics

    statisticsData.value = stats
    trainingBearingOptions.value = [...new Set(stats.map(s => s.bearing_name))]
    console.log('Statistics data loaded:', stats.length, 'records')
    console.log('Bearing options:', trainingBearingOptions.value)

    trainingLoading.value = false

    // ç­‰å¾… DOM æ›´æ–°å¾Œå†æ¸²æŸ“åœ–è¡¨
    await nextTick()
    renderCharts()
  } catch (error) {
    console.error('Failed to load training data:', error)
    ElMessage.error('è¼‰å…¥è¨“ç·´æ•¸æ“šå¤±æ•—: ' + (error.response?.data?.detail || error.message))
    trainingLoading.value = false
  }
}

const renderCharts = () => {
  renderVibrationChart()
  renderKurtosisChart()
}

const renderVibrationChart = () => {
  if (!chartContainer.value) {
    console.error('Chart container not found')
    return
  }

  const bearingData = statisticsData.value.filter(
    d => d.bearing_name === selectedTrainingBearing.value
  )

  console.log('Rendering vibration chart for:', selectedTrainingBearing.value)
  console.log('Bearing data points:', bearingData.length)

  if (bearingData.length === 0) {
    console.warn('No data for bearing:', selectedTrainingBearing.value)
    return
  }

  if (vibrationChart) {
    vibrationChart.destroy()
  }

  const ctx = chartContainer.value.getContext('2d')
  vibrationChart = new Chart(ctx, {
    type: 'line',
    data: {
      labels: bearingData.map(d => d.time_min),
      datasets: [
        {
          label: 'æ°´å¹³æŒ¯å‹• RMS',
          data: bearingData.map(d => d.horiz_rms),
          borderColor: 'rgb(54, 162, 235)',
          backgroundColor: 'rgba(54, 162, 235, 0.1)',
          tension: 0.1,
          pointRadius: 1,
          borderWidth: 2
        },
        {
          label: 'å‚ç›´æŒ¯å‹• RMS',
          data: bearingData.map(d => d.vert_rms),
          borderColor: 'rgb(75, 192, 192)',
          backgroundColor: 'rgba(75, 192, 192, 0.1)',
          tension: 0.1,
          pointRadius: 1,
          borderWidth: 2
        }
      ]
    },
    options: {
      responsive: true,
      maintainAspectRatio: false,
      plugins: {
        title: {
          display: true,
          text: `${selectedTrainingBearing.value} - æŒ¯å‹• RMS è¶¨å‹¢`
        },
        legend: {
          position: 'top'
        }
      },
      scales: {
        x: {
          title: {
            display: true,
            text: 'æ™‚é–“ (åˆ†é˜)'
          }
        },
        y: {
          title: {
            display: true,
            text: 'RMS å€¼'
          },
          beginAtZero: false
        }
      }
    }
  })
  console.log('Vibration chart rendered successfully')
}

const renderKurtosisChart = () => {
  if (!kurtosisChartContainer.value) {
    console.error('Kurtosis chart container not found')
    return
  }

  const bearingData = statisticsData.value.filter(
    d => d.bearing_name === selectedTrainingBearing.value
  )

  console.log('Rendering kurtosis chart for:', selectedTrainingBearing.value)
  console.log('Bearing data points:', bearingData.length)

  if (bearingData.length === 0) {
    console.warn('No data for bearing:', selectedTrainingBearing.value)
    return
  }

  if (kurtosisChart) {
    kurtosisChart.destroy()
  }

  const ctx = kurtosisChartContainer.value.getContext('2d')
  kurtosisChart = new Chart(ctx, {
    type: 'line',
    data: {
      labels: bearingData.map(d => d.time_min),
      datasets: [
        {
          label: 'æ°´å¹³æŒ¯å‹•å³°åº¦',
          data: bearingData.map(d => d.horiz_kurtosis),
          borderColor: 'rgb(255, 99, 132)',
          backgroundColor: 'rgba(255, 99, 132, 0.1)',
          tension: 0.1,
          pointRadius: 1,
          borderWidth: 2
        },
        {
          label: 'å‚ç›´æŒ¯å‹•å³°åº¦',
          data: bearingData.map(d => d.vert_kurtosis),
          borderColor: 'rgb(153, 102, 255)',
          backgroundColor: 'rgba(153, 102, 255, 0.1)',
          tension: 0.1,
          pointRadius: 1,
          borderWidth: 2
        },
        {
          label: 'æ­£å¸¸é–¾å€¼ (â‰ˆ3)',
          data: Array(bearingData.length).fill(3),
          borderColor: 'rgb(255, 206, 86)',
          borderDash: [5, 5],
          borderWidth: 2,
          pointRadius: 0
        }
      ]
    },
    options: {
      responsive: true,
      maintainAspectRatio: false,
      plugins: {
        title: {
          display: true,
          text: `${selectedTrainingBearing.value} - å³°åº¦è¶¨å‹¢ï¼ˆæ•…éšœæŒ‡æ¨™ï¼‰`
        },
        legend: {
          position: 'top'
        }
      },
      scales: {
        x: {
          title: {
            display: true,
            text: 'æ™‚é–“ (åˆ†é˜)'
          }
        },
        y: {
          title: {
            display: true,
            text: 'å³°åº¦å€¼'
          },
          beginAtZero: false
        }
      }
    }
  })
  console.log('Kurtosis chart rendered successfully')
}

const viewBearingDetails = (bearing) => {
  selectedTrainingBearing.value = bearing.name
  renderVibrationChart()
  renderKurtosisChart()

  // æ»¾å‹•åˆ°åœ–è¡¨å€åŸŸ
  const chartCard = document.querySelector('.chart-card')
  if (chartCard) {
    chartCard.scrollIntoView({ behavior: 'smooth' })
  }
}

watch(selectedTrainingBearing, () => {
  renderVibrationChart()
  renderKurtosisChart()
})

// Initialize
onMounted(() => {
  loadBearings()
  loadTrainingData()
})
</script>

<style scoped>
.dashboard {
  padding: 20px;
}

.header-stats {
  margin-bottom: 20px;
}

.stat-card {
  display: flex;
  align-items: center;
}

.stat-card :deep(.el-card__body) {
  display: flex;
  align-items: center;
  padding: 20px;
}

.stat-icon {
  width: 60px;
  height: 60px;
  border-radius: 12px;
  display: flex;
  align-items: center;
  justify-content: center;
  color: white;
  margin-right: 15px;
}

.stat-info h3 {
  font-size: 28px;
  font-weight: bold;
  margin: 0 0 5px;
  color: #303133;
}

.stat-info p {
  font-size: 14px;
  color: #909399;
  margin: 0;
}

.card-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
}

/* IEEE PHM 2012 å¯¦é©—æ‘˜è¦æ¨£å¼ */
.summary-card {
  height: 100%;
  border: 1px solid #f0f0f0;
  border-radius: 8px;
}

.summary-card :deep(.el-card__header) {
  background-color: #fafafa;
  border-bottom: 1px solid #f0f0f0;
  padding: 12px 16px;
}

.summary-header {
  display: flex;
  align-items: center;
  gap: 8px;
  font-weight: 600;
  color: #303133;
}

.summary-content {
  padding: 16px;
  font-size: 13px;
  line-height: 1.5;
}

.summary-content p {
  margin-bottom: 8px;
  color: #606266;
}

.summary-content ul {
  margin: 8px 0;
  padding-left: 20px;
}

.summary-content li {
  margin-bottom: 4px;
  color: #606266;
}

.summary-content strong {
  color: #303133;
}

.challenge-item {
  text-align: center;
  padding: 12px 8px;
  border-radius: 6px;
  background-color: #fafafa;
  height: 100%;
}

.challenge-item p {
  margin-top: 8px;
  font-size: 12px;
  color: #606266;
  line-height: 1.4;
}

.scoring-info {
  background-color: #f8f9fa;
  padding: 12px;
  border-radius: 6px;
  font-size: 12px;
  color: #606266;
  line-height: 1.5;
}

/* PHM Database Query Styles */
.section-title {
  color: #34495e;
  margin-bottom: 15px;
  font-size: 16px;
  font-weight: 600;
  border-bottom: 2px solid #409eff;
  padding-bottom: 8px;
}

.loading,
.error,
.empty {
  text-align: center;
  padding: 30px;
  color: #909399;
  font-size: 14px;
}

.error {
  color: #f56c6c;
}

.bearings-section {
  margin-bottom: 20px;
}

.bearings-grid {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
  gap: 15px;
}

.bearing-card {
  border: 2px solid #e4e7ed;
  border-radius: 8px;
  padding: 15px;
  cursor: pointer;
  transition: all 0.3s;
  background: #fff;
}

.bearing-card:hover {
  border-color: #409eff;
  transform: translateY(-2px);
  box-shadow: 0 4px 12px rgba(64, 158, 255, 0.2);
}

.bearing-card.active {
  border-color: #67c23a;
  background: #f0f9ff;
}

.bearing-card h4 {
  color: #303133;
  margin-bottom: 12px;
  font-size: 15px;
}

.bearing-stats {
  display: flex;
  flex-direction: column;
  gap: 8px;
}

.stat-item {
  display: flex;
  justify-content: space-between;
  font-size: 13px;
}

.stat-label {
  color: #909399;
}

.stat-value {
  font-weight: 600;
  color: #409eff;
}

.info-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
  gap: 15px;
}

.info-card {
  border: 1px solid #e4e7ed;
  border-radius: 8px;
}

.info-card :deep(.el-card__header) {
  background-color: #fafafa;
  border-bottom: 1px solid #e4e7ed;
  padding: 12px 16px;
}

.info-header {
  display: flex;
  align-items: center;
  gap: 8px;
  font-weight: 600;
  color: #409eff;
}

.info-content {
  padding: 12px;
}

.info-item {
  display: flex;
  justify-content: space-between;
  padding: 8px 0;
  border-bottom: 1px solid #f5f7fa;
  font-size: 13px;
}

.info-item:last-child {
  border-bottom: none;
}

.info-item .label {
  color: #909399;
}

.info-item .value {
  font-weight: 600;
  color: #303133;
}

.controls {
  display: flex;
  gap: 12px;
  align-items: center;
  margin-bottom: 15px;
  flex-wrap: wrap;
}

.page-info {
  color: #909399;
  font-size: 13px;
  margin-left: auto;
}

.anomaly-value {
  color: #f56c6c;
  font-weight: 600;
}

/* PHM Training Styles */
.loading-container {
  text-align: center;
  padding: 60px;
}

.loading-container .el-icon {
  font-size: 48px;
  margin-bottom: 16px;
}

.info-card-phm h4 {
  margin: 16px 0 8px 0;
  color: #409EFF;
}

.info-card-phm ul {
  margin: 8px 0;
  padding-left: 24px;
}

.info-card-phm li {
  margin: 8px 0;
  line-height: 1.6;
}

/* CALCE æ–¹æ³•æ¨£å¼ */
.method-title {
  display: flex;
  align-items: center;
  gap: 12px;
  font-size: 14px;
  font-weight: 600;
}

.method-content {
  padding: 16px 20px;
  background-color: #fafafa;
  border-radius: 6px;
  margin-top: 8px;
}

.method-content h4 {
  color: #409EFF;
  font-size: 14px;
  margin: 16px 0 8px 0;
  font-weight: 600;
}

.method-content h4:first-child {
  margin-top: 0;
}

.method-content p {
  color: #606266;
  line-height: 1.6;
  margin: 8px 0;
}

.method-content ol,
.method-content ul {
  margin: 8px 0;
  padding-left: 24px;
  color: #606266;
}

.method-content li {
  margin: 6px 0;
  line-height: 1.6;
}

.method-content ul ul {
  margin-top: 6px;
  padding-left: 20px;
}

.winner-info {
  display: flex;
  align-items: center;
  gap: 10px;
  background-color: #f0f9ff;
  padding: 12px 16px;
  border-radius: 6px;
  border-left: 4px solid #67c23a;
  color: #67c23a;
  font-weight: 600;
}

.feature-summary {
  background-color: #f8f9fa;
  padding: 16px;
  border-radius: 8px;
}

.feature-summary h4 {
  color: #303133;
  margin-bottom: 12px;
  font-size: 15px;
  font-weight: 600;
}

.feature-card {
  background-color: white;
  padding: 12px 16px;
  border-radius: 6px;
  border: 1px solid #e4e7ed;
  height: 100%;
}

.feature-card h5 {
  color: #409EFF;
  font-size: 13px;
  font-weight: 600;
  margin: 0 0 10px 0;
  padding-bottom: 8px;
  border-bottom: 2px solid #409EFF;
}

.feature-card ul {
  margin: 0;
  padding-left: 20px;
}

.feature-card li {
  color: #606266;
  font-size: 12px;
  line-height: 1.8;
  margin: 4px 0;
}

.contribution-section h4 {
  color: #303133;
  font-size: 15px;
  font-weight: 600;
  margin-bottom: 12px;
}

.contribution-section ol {
  margin: 0;
  padding-left: 24px;
}

.contribution-section li {
  color: #606266;
  line-height: 1.8;
  margin: 10px 0;
}
</style>
