# æ¶æ§‹æ•ˆèƒ½æ¯”è¼ƒåˆ†æï¼šHPLCS vs ç¾æœ‰å°ˆæ¡ˆ

## ğŸ“Š æ¶æ§‹å°æ¯”æ¦‚è¦½

### HPLCS (High-Performance Log Collection System) åƒè€ƒæ¶æ§‹

```
Test Devices (100 units)
    â†“
Nginx (Load Balancer) [:18723]
    â†“
FastAPI (2 instances, 10 workers total) â†’ Redis Stream â†’ Worker â†’ PostgreSQL
    â†“                    â†“
  Immediate Response   Cached Queries
```

**è¨­è¨ˆç›®æ¨™**ï¼šé«˜é€Ÿæ—¥èªŒæ”¶é›†ï¼ˆ10,000 req/sï¼‰ï¼Œ< 5ms éŸ¿æ‡‰æ™‚é–“

### ç¾æœ‰å°ˆæ¡ˆ (Vibration RUL Prognostics) æ¶æ§‹

```
Sensors (25.6 kHz sampling)
    â†“
FastAPI + WebSocket (Real-time) â†’ Buffer Manager â†’ Analysis Engine
    â†“                              â†“                  â†“
PostgreSQL + Redis (Streams + Cache + Pub/Sub)
    â†“
Frontend (Vue.js with WebSocket)
```

**è¨­è¨ˆç›®æ¨™**ï¼šå³æ™‚æŒ¯å‹•ç›£æ§ã€ç‰¹å¾µæå–ã€è­¦å ±ç³»çµ±ã€RUL é æ¸¬

---

## ğŸ¯ é—œéµå·®ç•°åˆ†æ

| ç¶­åº¦ | HPLCS åƒè€ƒæ¶æ§‹ | ç¾æœ‰å°ˆæ¡ˆæ¶æ§‹ |
|------|---------------|-------------|
| **è² è¼‰å‡è¡¡** | Nginx least_connï¼Œ2å€‹ FastAPI å¯¦ä¾‹ | Nginx å–®ä¸€ FastAPI å¯¦ä¾‹ |
| **Worker æ¶æ§‹** | ç¨ç«‹ Background Worker | å³æ™‚åˆ†æå™¨æ•´åˆåœ¨ FastAPI å…§ |
| **æ‰¹è™•ç†å¤§å°** | 100 logs/batch | 25,600 samples (1ç§’ @ 25.6kHz) |
| **éŸ¿æ‡‰æ™‚é–“ç›®æ¨™** | < 5ms (ç«‹å³è¿”å› queued) | å³æ™‚ WebSocket æ¨é€ |
| **ç·©å­˜ç­–ç•¥** | Redis TTL 5åˆ†é˜ (æŸ¥è©¢) | Redis å¤šå±¤ç·©å­˜ + Stream |
| **é€£æ¥æ± ** | Redis: 200, PG: 10+5 | Redis: æœªæ˜ç¢º, PG: 10-50 |
| **é€Ÿç‡é™åˆ¶** | 10,000 req/s | ç„¡æ˜ç¢ºé™åˆ¶ |

---

## ğŸ“ˆ æ•ˆèƒ½è©•ä¼°

### 1. **ååé‡ (Throughput)**

**HPLCS å„ªå‹¢**ï¼š
- å°ˆé–€è¨­è¨ˆç”¨æ–¼é«˜ååé‡æ—¥èªŒæ”¶é›†ï¼ˆ10,000 req/sï¼‰
- 2å€‹ FastAPI å¯¦ä¾‹ + 10 å€‹ worker ç¸½å…±
- ç«‹å³è¿”å›éŸ¿æ‡‰ï¼Œä¸ç­‰å¾… DB å¯«å…¥

**ç¾æœ‰å°ˆæ¡ˆç¾ç‹€**ï¼š
- å–®ä¸€ FastAPI å¯¦ä¾‹
- æ²’æœ‰ç¨ç«‹ Worker å±¤
- å³æ™‚è¨ˆç®—å¯èƒ½æˆç‚ºç“¶é ¸

**çµè«–**ï¼š**HPLCS æ¶æ§‹åœ¨ç´”ååé‡ä¸Šæ›´å„ª**

### 2. **å»¶é² (Latency)**

**HPLCS**ï¼š
- API éŸ¿æ‡‰ < 5msï¼ˆåƒ…å¯«å…¥ Redis Streamï¼‰
- æ•¸æ“šæŒä¹…åŒ–æœ‰å»¶é²ï¼ˆç•°æ­¥ Workerï¼‰

**ç¾æœ‰å°ˆæ¡ˆ**ï¼š
- WebSocket å³æ™‚æ¨é€
- å³æ™‚è¨ˆç®—å’Œç‰¹å¾µæå–å¢åŠ å»¶é²
- ä½†æ•¸æ“šæ›´å³æ™‚å¯ç”¨

**çµè«–**ï¼š**HPLCS API éŸ¿æ‡‰æ›´å¿«ï¼Œä½†ç¾æœ‰å°ˆæ¡ˆæä¾›æ›´å³æ™‚çš„æ•¸æ“šå¯è¦‹æ€§**

### 3. **å¯æ“´å±•æ€§ (Scalability)**

| é …ç›® | HPLCS | ç¾æœ‰å°ˆæ¡ˆ |
|------|-------|---------|
| FastAPI å¯¦ä¾‹æ“´å±• | âœ… æ”¯æ´ (least_conn) | âš ï¸ éœ€èª¿æ•´ |
| Worker æ“´å±• | âœ… ç¨ç«‹æ“´å±• | âŒ æ•´åˆåœ¨ API å…§ |
| æ•¸æ“šåº«é€£æ¥æ±  | âš ï¸ ä¿å®ˆ (10+5) | âœ… è¼ƒå¤§ (10-50) |

**çµè«–**ï¼š**HPLCS æ¶æ§‹æ“´å±•æ€§æ›´å¥½**

### 4. **å¯é æ€§å’Œå®¹éŒ¯**

**HPLCS å„ªå‹¢**ï¼š
- ç¨ç«‹ Workerï¼šAPI é‡å•Ÿä¸å½±éŸ¿æ•¸æ“šè™•ç†
- Redis Stream ä½œç‚ºç·©è¡å€ï¼šèƒŒå£“æ§åˆ¶
- æ¶ˆè²»è€…çµ„æ¨¡å¼ï¼šæ¶ˆæ¯ä¸ä¸Ÿå¤±

**ç¾æœ‰å°ˆæ¡ˆç¾ç‹€**ï¼š
- Buffer Manager æä¾›ä¸€å®šç·©è¡
- WebSocket è‡ªå‹•é‡é€£
- ä½†æ²’æœ‰ç¨ç«‹çš„æ¶ˆæ¯è™•ç†å±¤

**çµè«–**ï¼š**HPLCS æ¶æ§‹åœ¨å¯é æ€§è¨­è¨ˆä¸Šæ›´å®Œå–„**

---

## ğŸ” æ”¹é€²å»ºè­°

### çŸ­æœŸæ”¹é€²ï¼ˆä½æˆæœ¬ï¼Œé«˜æ•ˆç›Šï¼‰

1. **æ·»åŠ ç¨ç«‹ Worker æœå‹™**
   - å°‡å³æ™‚è¨ˆç®—å¾ FastAPI åˆ†é›¢
   - ä½¿ç”¨ Redis Stream æ¶ˆè²»è€…çµ„æ¨¡å¼

2. **å¢åŠ  FastAPI å¯¦ä¾‹**
   - ä¿®æ”¹ Nginx é…ç½®æ”¯æ´è² è¼‰å‡è¡¡
   - ä½¿ç”¨ least_conn ç®—æ³•

3. **å¯¦æ–½é€Ÿç‡é™åˆ¶**
   - åœ¨ Nginx å±¤æ·»åŠ  rate limiting
   - é˜²æ­¢ç³»çµ±éè¼‰

### ä¸­æœŸæ”¹é€²ï¼ˆéœ€è¦æ›´å¤šå·¥ä½œï¼‰

1. **å„ªåŒ–é€£æ¥æ± é…ç½®**
   - Redis: å¢åŠ åˆ° 200 é€£æ¥
   - PostgreSQL: èª¿æ•´ç‚º 10+5 æ¨¡å¼

2. **æ·»åŠ ç›£æ§å’Œè­¦å ±**
   - Prometheus + Grafana
   - ç³»çµ±å¥åº·æª¢æŸ¥

3. **å¯¦æ–½æ‰¹è™•ç†å„ªåŒ–**
   - æ•¸æ“šåº«æ‰¹é‡å¯«å…¥
   - Redis Pipeline å„ªåŒ–

---

## ğŸ“‹ çµè«–

### å“ªç¨®æ¶æ§‹æ•ˆèƒ½æ›´ä½³ï¼Ÿ

**å–æ±ºæ–¼ä½¿ç”¨å ´æ™¯**ï¼š

| å ´æ™¯ | æ¨è–¦æ¶æ§‹ | åŸå›  |
|------|---------|------|
| **é«˜é »æ—¥èªŒæ”¶é›†** (10k+ req/s) | HPLCS | å°ˆé–€è¨­è¨ˆï¼Œè§£è€¦è™•ç† |
| **å³æ™‚æŒ¯å‹•ç›£æ§** | ç¾æœ‰å°ˆæ¡ˆ | WebSocket + å³æ™‚è¨ˆç®— |
| **éœ€è¦æ•¸æ“šå¯é æ€§** | HPLCS | ç¨ç«‹ Worker + æ¶ˆæ¯ç¢ºèª |
| **éœ€è¦å³æ™‚å¯è¦–åŒ–** | ç¾æœ‰å°ˆæ¡ˆ | WebSocket æ¨é€æ¶æ§‹ |

### ç¶œåˆè©•åƒ¹

**HPLCS æ¶æ§‹åœ¨ç´”æ•ˆèƒ½æŒ‡æ¨™ä¸Šæ›´å„ª**ï¼ˆååé‡ã€å»¶é²ã€å¯æ“´å±•æ€§ï¼‰ï¼Œä½†ç¾æœ‰å°ˆæ¡ˆæ¶æ§‹æ›´é©åˆå…¶ç‰¹å®šç”¨é€”ï¼ˆå³æ™‚æŒ¯å‹•åˆ†æå’Œç›£æ§ï¼‰ã€‚

å»ºè­°æ¡ç”¨**æ··åˆæ¶æ§‹**ï¼š
- ä¿ç•™ç¾æœ‰å°ˆæ¡ˆçš„ WebSocket å³æ™‚æ¨é€èƒ½åŠ›
- å¼•å…¥ HPLCS çš„ç¨ç«‹ Worker å’Œ Redis Stream æ¶ˆè²»è€…çµ„æ¨¡å¼
- å¯¦æ–½è² è¼‰å‡è¡¡å’Œé€Ÿç‡é™åˆ¶

---

## ğŸ“ é—œéµæ–‡ä»¶åƒè€ƒ

| æ–‡ä»¶ | ç”¨é€” |
|------|------|
| `docker-compose.yml` | å®¹å™¨æœå‹™é…ç½® |
| `frontend/nginx.conf` | è² è¼‰å‡è¡¡é…ç½® |
| `backend/main.py` | FastAPI ä¸»æœå‹™ |
| `backend/redis_client.py` | Redis é€£æ¥ç®¡ç† |
| `backend/websocket_manager.py` | WebSocket é€£æ¥ç®¡ç† |
| `backend/realtime_analyzer.py` | å³æ™‚åˆ†æé‚è¼¯ |
